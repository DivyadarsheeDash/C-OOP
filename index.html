<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Parking Lot — Demo</title>
  <style>
    :root {
      --bg:#0f1724; --card:#0b1220; --accent:#60a5fa; --muted:#9aa7bf;
      --green:#10b981; --danger:#ef4444; --glass: rgba(255,255,255,0.03);
    }
    body { font-family: Inter, system-ui, Arial; margin:0; background:linear-gradient(180deg,#071029 0%, #081225 100%); color:#e6eef8; }
    .container { max-width:1100px; margin:28px auto; padding:20px; }
    header { display:flex; align-items:center; gap:18px; margin-bottom:18px;}
    header h1 { margin:0; font-size:20px; letter-spacing:0.2px; }
    .grid { display:grid; grid-template-columns: 360px 1fr; gap:18px; }
    .card { background:var(--card); border-radius:12px; padding:14px; box-shadow: 0 6px 18px rgba(3,6,12,0.6); }
    label { display:block; font-size:13px; color:var(--muted); margin-top:10px; }
    input[type="text"], select { width:100%; padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:var(--glass); color:inherit; }
    button { margin-top:12px; padding:10px 12px; border-radius:10px; border:0; cursor:pointer; background:var(--accent); color:#012; font-weight:600; }
    button.warn { background:var(--danger); color:#fff; }
    .status-list { display:grid; gap:8px; margin-top:10px; }
    .slot { display:flex; justify-content:space-between; align-items:center; padding:10px; border-radius:8px; background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); }
    .slot .left { display:flex; gap:10px; align-items:center; }
    .dot { width:12px; height:12px; border-radius:50%; }
    .dot.free { background:#94a3b8; }
    .dot.occ { background:var(--green); }
    .log { font-family: monospace; font-size:13px; color:var(--muted); max-height:240px; overflow:auto; padding:8px; border-radius:8px; background:#071426; margin-top:10px; }
    .top-controls { display:flex; gap:8px; align-items:center; }
    .small { font-size:12px; color:var(--muted); }
    footer { margin-top:18px; color:var(--muted); font-size:13px; text-align:center; }
    @media (max-width:900px){ .grid{grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" style="filter:drop-shadow(0 6px 16px rgba(2,6,23,0.6))">
        <rect x="1" y="4" width="22" height="14" rx="3" fill="#08203a"/>
        <path d="M3 10h18" stroke="#60a5fa" stroke-width="1.2"/>
        <circle cx="7.5" cy="15.5" r="1.8" fill="#94a3b8"/>
        <circle cx="16.5" cy="15.5" r="1.8" fill="#94a3b8"/>
      </svg>
      <div>
        <h1>Smart Parking Lot — Demo</h1>
        <div class="small">OOP demo (Vehicle, Car, Bike, ParkingSlot, ParkingLot) · Time-based billing</div>
      </div>
    </header>

    <div class="grid">
      <!-- Controls column -->
      <div>
        <div class="card">
          <h3 style="margin:0 0 8px 0">Park a Vehicle</h3>
          <label>Vehicle Type</label>
          <select id="vehicleType">
            <option value="Car">Car (₹20/hr)</option>
            <option value="Bike">Bike (₹10/hr)</option>
          </select>

          <label>Vehicle Number</label>
          <input id="vehicleNumber" type="text" placeholder="e.g. OD02A1234" />

          <div class="top-controls">
            <button id="parkBtn">Park Vehicle</button>
            <button id="parkSimBtn" style="background:#2a3340">Park (simulate earlier entry)</button>
          </div>

          <hr style="border:none; height:1px; background:rgba(255,255,255,0.03); margin:12px 0" />

          <h3 style="margin:0 0 8px 0">Release / Exit</h3>
          <label>Slot ID to release</label>
          <input id="releaseSlotId" type="text" placeholder="Enter slot id (e.g. 1)" />
          <button id="releaseBtn" class="warn">Release Vehicle</button>

          <hr style="border:none; height:1px; background:rgba(255,255,255,0.03); margin:12px 0" />

          <h3 style="margin:0 0 8px 0">Demo Controls</h3>
          <div class="small">You can fast-forward time for parked vehicles to simulate longer stays.</div>
          <label>Fast-forward minutes for all parked vehicles</label>
          <input id="fastForwardMinutes" type="text" placeholder="e.g. 60" />
          <button id="fastForwardBtn">Fast-forward</button>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <h3 style="margin:0 0 8px 0">Log</h3>
          <div id="log" class="log"></div>
          <div style="display:flex; gap:8px; margin-top:10px;">
            <button id="clearLog">Clear Log</button>
            <button id="downloadLog" style="background:#9aa7bf; color:#012">Download</button>
          </div>
        </div>
      </div>

      <!-- Status column -->
      <div>
        <div class="card" style="margin-bottom:12px;">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0">Parking Lot Status</h3>
            <div class="small">Slots: <span id="totalSlots">4</span></div>
          </div>
          <div id="statusList" class="status-list" style="margin-top:12px;"></div>
        </div>

        <div class="card">
          <h3 style="margin:0 0 8px 0">Recent Activity</h3>
          <div id="activity" class="log" style="max-height:160px;"></div>
        </div>
      </div>
    </div>

    <footer>
      Demo by Smart Parking Lot System — uses JS classes to model your C++ code. Time displayed in minutes, fees in ₹.
    </footer>
  </div>

  <script>
    /**********************************************
     * JavaScript OOP model mapping the C++ demo
     **********************************************/

    // Base Vehicle class
    class Vehicle {
      constructor(number, type, entryTime = Date.now()) {
        this.vehicleNumber = number;
        this.vehicleType = type;
        this.entryTime = entryTime; // milliseconds
      }
      // calculateFee expects exitTime in ms
      calculateFee(exitTime) {
        throw new Error('calculateFee must be implemented');
      }
      display() {
        return `${this.vehicleType} (${this.vehicleNumber})`;
      }
    }

    // Car and Bike subclasses
    class Car extends Vehicle {
      constructor(number, entryTime) { super(number, 'Car', entryTime); }
      calculateFee(exitTime) {
        const hours = (exitTime - this.entryTime) / 1000 / 3600;
        return 20 * hours;
      }
    }

    class Bike extends Vehicle {
      constructor(number, entryTime) { super(number, 'Bike', entryTime); }
      calculateFee(exitTime) {
        const hours = (exitTime - this.entryTime) / 1000 / 3600;
        return 10 * hours;
      }
    }

    // ParkingSlot
    class ParkingSlot {
      constructor(slotId) {
        this.slotId = slotId;
        this.occupied = false;
        this.vehicle = null;
      }
      isOccupied() { return this.occupied; }
      parkVehicle(v) {
        this.vehicle = v;
        this.occupied = true;
      }
      releaseVehicle() {
        const v = this.vehicle;
        this.vehicle = null;
        this.occupied = false;
        return v;
      }
    }

    // ParkingLot
    class ParkingLot {
      constructor(totalSlots) {
        this.slots = [];
        for (let i = 1; i <= totalSlots; i++) this.slots.push(new ParkingSlot(i));
        this.activity = []; // simple activity log
      }

      allocateSlot(vehicle) {
        for (const slot of this.slots) {
          if (!slot.isOccupied()) {
            slot.parkVehicle(vehicle);
            this._log(`${vehicle.display()} parked in slot ${slot.slotId}`);
            return slot.slotId;
          }
        }
        this._log('No available slot for ' + vehicle.display());
        return -1;
      }

      releaseSlot(slotId) {
        if (!Number.isInteger(slotId) || slotId <= 0 || slotId > this.slots.length) {
          this._log('Invalid slot id: ' + slotId);
          return null;
        }
        const slot = this.slots[slotId - 1];
        if (!slot.isOccupied()) {
          this._log(`Slot ${slotId} already empty`);
          return null;
        }
        const v = slot.releaseVehicle();
        const exitTime = Date.now();
        const fee = v.calculateFee(exitTime);
        const minutes = (exitTime - v.entryTime) / 1000 / 60;
        this._log(`${v.display()} exited from slot ${slotId} | Duration: ${minutes.toFixed(2)} min | Fee: ₹${fee.toFixed(2)}`);
        return { vehicle: v, durationMin: minutes, fee: fee };
      }

      getStatus() { return this.slots.map(s => ({ id: s.slotId, occupied: s.occupied, vehicle: s.vehicle })); }

      fastForwardMinutes(minutes) {
        // Move entry times into the past by minutes (simulate older entries)
        const shift = minutes * 60 * 1000;
        for (const slot of this.slots) {
          if (slot.isOccupied()) slot.vehicle.entryTime -= shift;
        }
        this._log(`Fast-forwarded ${minutes} minute(s) for all parked vehicles`);
      }

      _log(message) {
        const t = new Date().toLocaleTimeString();
        this.activity.unshift(`[${t}] ${message}`); // newest first
        updateUI();
      }

      getActivity() { return this.activity.slice(0, 200); }
    }

    /**********************************************
     * UI wiring
     **********************************************/
    const lot = new ParkingLot(4); // same as the C++ demo (4 slots)
    document.getElementById('totalSlots').textContent = 4;

    const statusListEl = document.getElementById('statusList');
    const activityEl = document.getElementById('activity');
    const logEl = document.getElementById('log');

    function updateUI() {
      // update status list
      statusListEl.innerHTML = '';
      for (const s of lot.getStatus()) {
        const slotDiv = document.createElement('div');
        slotDiv.className = 'slot';
        slotDiv.innerHTML = `
          <div class="left">
            <div class="dot ${s.occupied ? 'occ' : 'free'}"></div>
            <div>
              <div style="font-weight:700">Slot ${s.id}</div>
              <div class="small">${s.occupied ? s.vehicle.display() : 'Available'}</div>
            </div>
          </div>
          <div class="right small">${s.occupied ? ageString(s.vehicle.entryTime) + ' ago' : ''}</div>
        `;
        statusListEl.appendChild(slotDiv);
      }

      // activity
      activityEl.innerHTML = lot.getActivity().slice(0,60).map(x => x).join('\n');

      // log: mirror activity for demo
      logEl.innerHTML = lot.getActivity().slice(0,200).map(x => x).join('\n');
    }

    function ageString(entryMs) {
      const diff = Date.now() - entryMs;
      const min = Math.floor(diff/60000);
      if (min < 1) return '<1 min';
      if (min < 60) return `${min} min`;
      const hr = Math.floor(min/60);
      const rem = min % 60;
      return `${hr}h ${rem}m`;
    }

    // Park button
    document.getElementById('parkBtn').addEventListener('click', () => {
      const type = document.getElementById('vehicleType').value;
      const num = document.getElementById('vehicleNumber').value.trim() || generatePlate();
      let v;
      if (type === 'Car') v = new Car(num);
      else v = new Bike(num);
      const slot = lot.allocateSlot(v);
      if (slot === -1) alert('No available slot!');
      document.getElementById('vehicleNumber').value = '';
      updateUI();
    });

    // Park simulate earlier entry (park but make entry time in the past for demo)
    document.getElementById('parkSimBtn').addEventListener('click', () => {
      const type = document.getElementById('vehicleType').value;
      const num = document.getElementById('vehicleNumber').value.trim() || generatePlate();
      // ask user for minutes ago
      const mins = prompt('How many minutes ago should this vehicle have entered? (e.g. 90)', '90');
      let minutesAgo = parseInt(mins);
      if (!Number.isFinite(minutesAgo)) minutesAgo = 90;
      const when = Date.now() - minutesAgo*60*1000;
      let v;
      if (type === 'Car') v = new Car(num, when);
      else v = new Bike(num, when);
      const slot = lot.allocateSlot(v);
      if (slot === -1) alert('No available slot!');
      document.getElementById('vehicleNumber').value = '';
      updateUI();
    });

    // Release button
    document.getElementById('releaseBtn').addEventListener('click', () => {
      const idText = document.getElementById('releaseSlotId').value.trim();
      const id = parseInt(idText);
      if (!Number.isInteger(id)) { alert('Enter a valid slot id'); return; }
      const result = lot.releaseSlot(id);
      if (result) {
        // show neat popup with fee
        alert(`${result.vehicle.display()} exited.\nDuration: ${result.durationMin.toFixed(2)} min\nTotal Fee: ₹${result.fee.toFixed(2)}`);
      }
      document.getElementById('releaseSlotId').value = '';
      updateUI();
    });

    // Fast-forward
    document.getElementById('fastForwardBtn').addEventListener('click', () => {
      const mins = parseInt(document.getElementById('fastForwardMinutes').value);
      if (!Number.isFinite(mins)) { alert('Enter integer minutes'); return; }
      lot.fastForwardMinutes(mins);
      document.getElementById('fastForwardMinutes').value = '';
      updateUI();
    });

    // Log controls
    document.getElementById('clearLog').addEventListener('click', () => {
      lot.activity = [];
      updateUI();
    });

    document.getElementById('downloadLog').addEventListener('click', () => {
      const blob = new Blob([lot.getActivity().join('\n')], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'parking_log.txt';
      a.click();
      URL.revokeObjectURL(url);
    });

    // utility: generate a fake plate if user leaves blank
    function generatePlate(){
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const digits = '0123456789';
      return 'OD' + (Math.floor(Math.random()*90)+10) + letters.charAt(Math.floor(Math.random()*26)) + (Math.floor(Math.random()*900)+100);
    }

    // initial demo: park two vehicles to mirror your C++ demo
    (function seedDemo(){
      const v1 = new Car('OD02A1234'); lot.allocateSlot(v1);
      const v2 = new Bike('OD33B9876'); lot.allocateSlot(v2);
      // simulate a small passage of time for demo visual
      setTimeout(()=> {
        updateUI();
      }, 500);
    })();

    // update UI every 3 seconds to refresh "age" strings
    setInterval(updateUI, 3000);
    updateUI();

  </script>
</body>
</html>
